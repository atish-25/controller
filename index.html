<!DOCTYPE html>
<html>
<head>
    <script>
        var recognition;

        // Check if SpeechRecognition is supported
        if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            
            recognition.continuous = true; // Keep listening even after speech pauses
            recognition.interimResults = false; // Only capture final results
            recognition.lang = "en-US";

            recognition.onresult = function(event) {
                var transcript = event.results[event.results.length - 1][0].transcript.trim();
                console.log("Recognized:", transcript); // Debugging output
                
                // Check if App Inventor WebView is available
                if (window.AppInventor) {
                    window.AppInventor.setWebViewString(transcript);
                }
            };

            recognition.onend = function() {
                console.log("Speech recognition stopped. Restarting...");
                recognition.start(); // Auto-restart on silence
            };

            recognition.onerror = function(event) {
                console.error("Speech Recognition Error:", event.error);
                if (event.error === "not-allowed") {
                    alert("Microphone access is blocked. Please allow it in browser settings.");
                }
            };

            function startListening() {
                recognition.start();
                console.log("Listening...");
            }

            function stopListening() {
                recognition.stop();
                console.log("Stopped listening.");
            }
        } else {
            alert("Speech recognition is not supported in this browser.");
        }
    </script>
</head>
<body>
    <button onclick="startListening()">Start Listening</button>
    <button onclick="stopListening()">Stop Listening</button>
</body>
</html>
